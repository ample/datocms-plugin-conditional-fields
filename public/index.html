<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="https://unpkg.com/datocms-plugins-sdk"></script>
  </head>
  <body>
    <script type="text/javascript">
      DatoCmsPlugin.init(function(plugin) {
        const permanentFieldKeys = ["title", "body", "layout"];
        const tempFieldsKeys = Object.values(plugin.fields)
          .filter(f => !permanentFieldKeys.includes(f.attributes.api_key))
          .map(f => f.attributes.api_key);

        function toggleFields(layout) {
          // Hide fields
          tempFieldsKeys.map(f => plugin.toggleField(f, false));

          // Show fields
          tempFieldsKeys
            .filter(f => f.startsWith(layout.toLowerCase()))
            .map(f => plugin.toggleField(f, true));
        }

        toggleFields(plugin.getFieldValue(plugin.fieldPath));

        const unsubscribe = plugin.addFieldChangeListener(
          plugin.fieldPath,
          value => toggleFields(value)
        );
      });
    </script>
  </body>
</html>
